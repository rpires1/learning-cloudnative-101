(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{"013z":function(e,t,a){"use strict";var n=a("q1tI"),r=a.n(n),l=a("NmYn"),o=a.n(l),s=a("Wbzz"),c=a("Xrax"),i=a("k4MR"),b=a("TSYQ"),p=a.n(b),m=a("QH2O"),d=a.n(m),u=a("qKvR"),g=function(e){var t,a=e.title,n=e.theme,r=e.tabs,l=void 0===r?[]:r;return Object(u.b)("div",{className:p()(d.a.pageHeader,(t={},t[d.a.withTabs]=l.length,t[d.a.darkMode]="dark"===n,t))},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12"},Object(u.b)("h1",{id:"page-title",className:d.a.text},a)))))},j=a("BAC9"),O=function(e){var t=e.relativePagePath,a=e.repository,n=Object(s.useStaticQuery)("1364590287").site.siteMetadata.repository,r=a||n,l=r.baseUrl,o=r.subDirectory,c=l+"/edit/"+r.branch+o+"/src/pages"+t;return l?Object(u.b)("div",{className:"bx--row "+j.row},Object(u.b)("div",{className:"bx--col"},Object(u.b)("a",{className:j.link,href:c},"Edit this page on GitHub"))):null},h=a("FCXl"),x=a("dI71"),N=a("I8xM"),f=function(e){function t(){return e.apply(this,arguments)||this}return Object(x.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,a=e.tabs,n=e.slug,r=n.split("/").filter(Boolean).slice(-1)[0],l=a.map((function(e){var t,a=o()(e,{lower:!0,strict:!0}),l=a===r,c=new RegExp(r+"/?(#.*)?$"),i=n.replace(c,a);return Object(u.b)("li",{key:e,className:p()((t={},t[N.selectedItem]=l,t),N.listItem)},Object(u.b)(s.Link,{className:N.link,to:""+i},e))}));return Object(u.b)("div",{className:N.tabsContainer},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(u.b)("nav",{"aria-label":t},Object(u.b)("ul",{className:N.list},l))))))},t}(r.a.Component),w=a("MjG9"),A=a("CzIb"),v=a("Asxa"),T=a("OIbQ"),y=a.n(T),P=function(e){var t=e.date,a=new Date(t);return t?Object(u.b)(v.c,{className:y.a.row},Object(u.b)(v.a,null,Object(u.b)("div",{className:y.a.text},"Page last updated: ",a.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null};t.a=function(e){var t=e.pageContext,a=e.children,n=e.location,r=e.Title,l=t.frontmatter,b=void 0===l?{}:l,p=t.relativePagePath,m=t.titleType,d=b.tabs,j=b.title,x=b.theme,N=b.description,v=b.keywords,T=b.date,y=Object(A.a)().interiorTheme,k=Object(s.useStaticQuery)("2456312558").site.pathPrefix,E=k?n.pathname.replace(k,""):n.pathname,q=d?E.split("/").filter(Boolean).slice(-1)[0]||o()(d[0],{lower:!0}):"",C=x||y;return Object(u.b)(i.a,{tabs:d,homepage:!1,theme:C,pageTitle:j,pageDescription:N,pageKeywords:v,titleType:m},Object(u.b)(g,{title:r?Object(u.b)(r,null):j,label:"label",tabs:d,theme:C}),d&&Object(u.b)(f,{title:j,slug:E,tabs:d,currentTab:q}),Object(u.b)(w.a,{padded:!0},a,Object(u.b)(O,{relativePagePath:p}),Object(u.b)(P,{date:T})),Object(u.b)(h.a,{pageContext:t,location:n,slug:E,tabs:d,currentTab:q}),Object(u.b)(c.a,null))}},BAC9:function(e,t,a){e.exports={bxTextTruncateEnd:"EditLink-module--bx--text-truncate--end--2pqje",bxTextTruncateFront:"EditLink-module--bx--text-truncate--front--3_lIE",link:"EditLink-module--link--1qzW3",row:"EditLink-module--row--1B9Gk"}},I8xM:function(e,t,a){e.exports={bxTextTruncateEnd:"PageTabs-module--bx--text-truncate--end--267NA",bxTextTruncateFront:"PageTabs-module--bx--text-truncate--front--3xEQF",tabsContainer:"PageTabs-module--tabs-container--8N4k0",list:"PageTabs-module--list--3eFQc",listItem:"PageTabs-module--list-item--nUmtD",link:"PageTabs-module--link--1mDJ1",selectedItem:"PageTabs-module--selected-item--YPVr3"}},OIbQ:function(e,t,a){e.exports={bxTextTruncateEnd:"last-modified-date-module--bx--text-truncate--end--123zi",bxTextTruncateFront:"last-modified-date-module--bx--text-truncate--front--3xeKz",text:"last-modified-date-module--text--24m-4",row:"last-modified-date-module--row--2BquN"}},QH2O:function(e,t,a){e.exports={bxTextTruncateEnd:"PageHeader-module--bx--text-truncate--end--mZWeX",bxTextTruncateFront:"PageHeader-module--bx--text-truncate--front--3zvrI",pageHeader:"PageHeader-module--page-header--3hIan",darkMode:"PageHeader-module--dark-mode--hBrwL",withTabs:"PageHeader-module--with-tabs--3nKxA",text:"PageHeader-module--text--o9LFq"}},p7lZ:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return c})),a.d(t,"default",(function(){return p}));var n=a("wx14"),r=a("zLVn"),l=(a("q1tI"),a("7ljp")),o=a("013z"),s=(a("qKvR"),["components"]),c={},i={_frontmatter:c},b=o.a;function p(e){var t=e.components,a=Object(r.a)(e,s);return Object(l.b)(b,Object(n.a)({},i,a,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h3",null,"Prerequisite"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Configure the LogDNA Agent on a kubernetes cluster, you can use one of the labs in this bootcamp located ",Object(l.b)("a",{parentName:"li",href:"/electives/logging/logdna/#activities"},"here"))),Object(l.b)("h2",null,"Logging library in Node.js"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"There are multiple logging libraries available for Node.js, on this example we are going to use ",Object(l.b)("a",{parentName:"p",href:"https://www.npmjs.com/package/pino"},"pino"))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"You can instrument a Node.js express web server using ",Object(l.b)("inlineCode",{parentName:"p"},"pino-http")," the example is located in GitHub ",Object(l.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/learning-cloudnative-101/blob/master/examples/logging/nodejs/app.js"},"app.js")))),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-javascript"},"const express = require('express')\nconst isProduction = process.env.NODE_ENV === 'production'\nconst formatters = {\n    level(label, number) {\n        return { level: label }\n    }\n}\nconst pino = require('pino-http')({\n    prettyPrint: isProduction ? false : true,\n    level: isProduction ? 'error' : 'info',\n    formatters: formatters,\n    messageKey: 'message'\n})\nconst PORT = process.env.PORT || 8080;\n\nvar app = express()\n\napp.use(pino)\n\napp.get('/', function (req, res) {\n    req.log.info('this is a info log message')\n    res.send('Hello World')\n})\napp.get('/error', function (req, res, next) {\n    req.log.error('Internal error with request /error')\n    res.status(503).send('Internal error')\n})\n\napp.listen(PORT, () => {\n    console.log(`Listening on PORT=${PORT} and isProduction=${isProduction}`);\n})\n")),Object(l.b)("h2",null,"Deploy the sample application"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Create a namespace",Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},"kubectl create deployment my-app --image=ibmcase/nodejs-logging-example\n")))),Object(l.b)("h2",null,"Test the application"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Expose application web service on local port 8080"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-shell"},"kubectl port-forward deployment/my-app 8080:8080\n"))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Send http request to the web service"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-shell"},'while true; do sleep 1; curl http://localhost:8080/error -s -w "\\n"; done\n')),Object(l.b)("p",{parentName:"li"},"  Output looks like this"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre"},"Internal error\n"))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Get the logs"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},"kubectl logs deployment/my-app -f\n"))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"The error line printend is JSON"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-json"},'{"level":"error","time":1591588923197,"pid":25,"hostname":"my-app-78647889d5-nv4rt","req":{"id":2,"method":"GET","url":"/error","headers":{"host":"localhost:8080","user-agent":"curl/7.64.1","accept":"*/*"},"remoteAddress":"::ffff:127.0.0.1","remotePort":48458},"message":"Internal error with request /error"}\n')))),Object(l.b)("h2",null,"Find the JSON logs in LogDNA"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Open the Views"),Object(l.b)("li",{parentName:"ul"},"Search for ",Object(l.b)("inlineCode",{parentName:"li"},"container:nodejs-logging-example"))),Object(l.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(l.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"54.513888888888886%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgElEQVQoz41SyU7DMBDNRyChJrHjOPGSJk6cpC3pknSRaFV6aoGySKBy4syVG+IP+GLshAqoAPE0Go1H8+bZMzYY5zIKRzErJY9EjKN8Phi/bM6FTLI0TeLY87BlWbZtA2AfwEhSsVyfdbq9siyLop9meSfXlmXaCCEQQucnAACM1Th+up8ihJqipqW17/0b84MMTHNzt1xdL5GDtGk0UVPzlQwPyUfH5uPN+O31tlcV7SCglPyhdkhWCpLCzdVs9/wQRSEh/n+YSsD3PSPjeCQ5UZqcAD1SDfgJUBus71yf60GoqTBKDMHIdtYPOA85FdmAi5wHIfZo/W7XcV3tkQtsRdUZElDsq4zDODXCJFnvtnkvT6QsF5P55bI7PKkWk1jKNM+k2nWWKn96sajmVSRE3E1YQH3it9vcCINQLdS0TLUYB0FMMHQgwgh8B6bY1Um71WpZpqW8h11jMByJKJxUxbgqplVfxZ7nK5A92kqCc0YZ8QmllDHmqU+HsRrbO0eYZU7M1WRLAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(l.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"json-logs-nodejs",title:"json-logs-nodejs",src:"/static/59c01581470828c33cfc5a842b84c0cc/3cbba/json-logs-nodejs.png",srcSet:["/static/59c01581470828c33cfc5a842b84c0cc/7fc1e/json-logs-nodejs.png 288w","/static/59c01581470828c33cfc5a842b84c0cc/a5df1/json-logs-nodejs.png 576w","/static/59c01581470828c33cfc5a842b84c0cc/3cbba/json-logs-nodejs.png 1152w","/static/59c01581470828c33cfc5a842b84c0cc/92c65/json-logs-nodejs.png 1216w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "))}p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-electives-logging-logdna-activities-logger-nodejs-mdx-3c238c7759f078255a5b.js.map