(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{"013z":function(e,t,a){"use strict";var n=a("q1tI"),r=a.n(n),l=a("NmYn"),s=a.n(l),o=a("Wbzz"),i=a("Xrax"),c=a("k4MR"),b=a("TSYQ"),p=a.n(b),m=a("QH2O"),u=a.n(m),d=a("qKvR"),h=function(e){var t,a=e.title,n=e.theme,r=e.tabs,l=void 0===r?[]:r;return Object(d.b)("div",{className:p()(u.a.pageHeader,(t={},t[u.a.withTabs]=l.length,t[u.a.darkMode]="dark"===n,t))},Object(d.b)("div",{className:"bx--grid"},Object(d.b)("div",{className:"bx--row"},Object(d.b)("div",{className:"bx--col-lg-12"},Object(d.b)("h1",{id:"page-title",className:u.a.text},a)))))},O=a("BAC9"),g=function(e){var t=e.relativePagePath,a=e.repository,n=Object(o.useStaticQuery)("1364590287").site.siteMetadata.repository,r=a||n,l=r.baseUrl,s=r.subDirectory,i=l+"/edit/"+r.branch+s+"/src/pages"+t;return l?Object(d.b)("div",{className:"bx--row "+O.row},Object(d.b)("div",{className:"bx--col"},Object(d.b)("a",{className:O.link,href:i},"Edit this page on GitHub"))):null},j=a("FCXl"),N=a("dI71"),x=a("I8xM"),f=function(e){function t(){return e.apply(this,arguments)||this}return Object(N.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,a=e.tabs,n=e.slug,r=n.split("/").filter(Boolean).slice(-1)[0],l=a.map((function(e){var t,a=s()(e,{lower:!0,strict:!0}),l=a===r,i=new RegExp(r+"/?(#.*)?$"),c=n.replace(i,a);return Object(d.b)("li",{key:e,className:p()((t={},t[x.selectedItem]=l,t),x.listItem)},Object(d.b)(o.Link,{className:x.link,to:""+c},e))}));return Object(d.b)("div",{className:x.tabsContainer},Object(d.b)("div",{className:"bx--grid"},Object(d.b)("div",{className:"bx--row"},Object(d.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(d.b)("nav",{"aria-label":t},Object(d.b)("ul",{className:x.list},l))))))},t}(r.a.Component),w=a("MjG9"),k=a("CzIb"),v=a("Asxa"),y=a("OIbQ"),I=a.n(y),T=function(e){var t=e.date,a=new Date(t);return t?Object(d.b)(v.c,{className:I.a.row},Object(d.b)(v.a,null,Object(d.b)("div",{className:I.a.text},"Page last updated: ",a.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null};t.a=function(e){var t=e.pageContext,a=e.children,n=e.location,r=e.Title,l=t.frontmatter,b=void 0===l?{}:l,p=t.relativePagePath,m=t.titleType,u=b.tabs,O=b.title,N=b.theme,x=b.description,v=b.keywords,y=b.date,I=Object(k.a)().interiorTheme,P=Object(o.useStaticQuery)("2456312558").site.pathPrefix,C=P?n.pathname.replace(P,""):n.pathname,M=u?C.split("/").filter(Boolean).slice(-1)[0]||s()(u[0],{lower:!0}):"",A=N||I;return Object(d.b)(c.a,{tabs:u,homepage:!1,theme:A,pageTitle:O,pageDescription:x,pageKeywords:v,titleType:m},Object(d.b)(h,{title:r?Object(d.b)(r,null):O,label:"label",tabs:u,theme:A}),u&&Object(d.b)(f,{title:O,slug:C,tabs:u,currentTab:M}),Object(d.b)(w.a,{padded:!0},a,Object(d.b)(g,{relativePagePath:p}),Object(d.b)(T,{date:y})),Object(d.b)(j.a,{pageContext:t,location:n,slug:C,tabs:u,currentTab:M}),Object(d.b)(i.a,null))}},BAC9:function(e,t,a){e.exports={bxTextTruncateEnd:"EditLink-module--bx--text-truncate--end--2pqje",bxTextTruncateFront:"EditLink-module--bx--text-truncate--front--3_lIE",link:"EditLink-module--link--1qzW3",row:"EditLink-module--row--1B9Gk"}},I8xM:function(e,t,a){e.exports={bxTextTruncateEnd:"PageTabs-module--bx--text-truncate--end--267NA",bxTextTruncateFront:"PageTabs-module--bx--text-truncate--front--3xEQF",tabsContainer:"PageTabs-module--tabs-container--8N4k0",list:"PageTabs-module--list--3eFQc",listItem:"PageTabs-module--list-item--nUmtD",link:"PageTabs-module--link--1mDJ1",selectedItem:"PageTabs-module--selected-item--YPVr3"}},OIbQ:function(e,t,a){e.exports={bxTextTruncateEnd:"last-modified-date-module--bx--text-truncate--end--123zi",bxTextTruncateFront:"last-modified-date-module--bx--text-truncate--front--3xeKz",text:"last-modified-date-module--text--24m-4",row:"last-modified-date-module--row--2BquN"}},QH2O:function(e,t,a){e.exports={bxTextTruncateEnd:"PageHeader-module--bx--text-truncate--end--mZWeX",bxTextTruncateFront:"PageHeader-module--bx--text-truncate--front--3zvrI",pageHeader:"PageHeader-module--page-header--3hIan",darkMode:"PageHeader-module--dark-mode--hBrwL",withTabs:"PageHeader-module--with-tabs--3nKxA",text:"PageHeader-module--text--o9LFq"}},WCcz:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return i})),a.d(t,"default",(function(){return p}));var n=a("wx14"),r=a("zLVn"),l=(a("q1tI"),a("7ljp")),s=a("013z"),o=(a("qKvR"),["components"]),i={},c={_frontmatter:i},b=s.a;function p(e){var t=e.components,a=Object(r.a)(e,o);return Object(l.b)(b,Object(n.a)({},c,a,{components:t,mdxType:"MDXLayout"}),Object(l.b)("p",null,"The ",Object(l.b)("a",{parentName:"p",href:"https://www.ibm.com/cloud/container-service"},"IBM Kubernetes service")," free clusters consist of a single worker node with 2 CPU and 4 GB of memory for experimenting with Kubernetes. Unlike the fee-based service, these clusters do not include capabilities for application load balancing using ingress out-of-the-box. "),Object(l.b)("h2",null,"Prerequisites"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Free IBM Kubernetes Cluster (IKS) - upgrade your account from ",Object(l.b)("strong",{parentName:"li"},"Lite")," plan to create one. In the example commands, weâ€™ll assume that this cluster is named ",Object(l.b)("inlineCode",{parentName:"li"},"mycluster")),Object(l.b)("li",{parentName:"ul"},"kubectl - match your cluster API version "),Object(l.b)("li",{parentName:"ul"},"Log in to IBM Cloud and configure ",Object(l.b)("inlineCode",{parentName:"li"},"kubectl")," using the ",Object(l.b)("inlineCode",{parentName:"li"},"ibmcloud ks cluster config --cluster mycluster")," command")),Object(l.b)("h2",null,"Components"),Object(l.b)("p",null,"On the IKS cluster, you will install helm charts for a ",Object(l.b)("a",{parentName:"p",href:"https://github.com/nginxinc/kubernetes-ingress/tree/release-1.7/deployments/helm-chart"},"nginx ingress controller")," from NGINX. This lab already provides the templated yaml files so there is no need to use helm cli."),Object(l.b)("h2",null,"Set up the ingress controller"),Object(l.b)("p",null,Object(l.b)("em",{parentName:"p"},"Only do this on a free IKS instance")," These steps assume facts that only apply to free IKS instances:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"a single worker where the cluster administrator can create pods that bind to host ports"),Object(l.b)("li",{parentName:"ul"},"no pre-existing ingress controller or application load balancer")),Object(l.b)("p",null,"Using the following steps with a paid instance can cause issues. See the ",Object(l.b)("a",{parentName:"p",href:"https://cloud.ibm.com/docs/containers?topic=containers-cs_network_planning"},"IBM Cloud containers documentation")," for information on exposing applications with the ingress/alb services for paid clusters. ",Object(l.b)("strong",{parentName:"p"},"You have been warned")),Object(l.b)("ol",null,Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Install the NGINX ingress controller with ",Object(l.b)("inlineCode",{parentName:"p"},"helm")," using a daemonset and no service resource (which will result in a single pod that binds to ports 80 and 443 on the worker node and will skip creation of a ",Object(l.b)("inlineCode",{parentName:"p"},"ClusterIP, LoadBalancer, or NodePort")," for the daemonset)."),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f https://cloudnative101.dev/yamls/ingress-controller/iks-ingress-v1.7.1.yaml\n"))),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"You can use free domain ",Object(l.b)("inlineCode",{parentName:"p"},".nip.io")," to get a domain name using one of the IP Address of your worker nodes. Run this command to set your DOMAIN"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},"export DOMAIN=$(kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type==\"ExternalIP\")].address}').nip.io\necho $DOMAIN\n"))),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"You can test the ingress controller using the ",Object(l.b)("inlineCode",{parentName:"p"},"$DOMAIN"),":"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},"curl -I http://$DOMAIN\n")),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre"},"HTTP/1.1 404 Not Found\nServer: nginx/1.17.10\n...\n")),Object(l.b)("p",{parentName:"li"},"A ",Object(l.b)("strong",{parentName:"p"},"404")," is expected at this point because unlike the ",Object(l.b)("a",{parentName:"p",href:"https://github.com/kubernetes/ingress-nginx"},"kubernetes nginx ingress"),", the NGINX version of the ingress controller does not create a default backend deployment.")),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"To use the ingress controller deploy a sample application, expose a service."),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},"kubectl create deployment web --image=bitnami/nginx\nkubectl expose deployment web --name=web --port 8080\n"))),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Now create an Ingress resource"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},'cat <<EOF | kubectl apply -f -\napiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: web\n  labels:\n    app: web\nspec:\n  rules:\n    - host: web.$DOMAIN\n      http:\n        paths:\n          - path: /\n            backend:\n              serviceName: web\n              servicePort: 8080\nEOF\necho "Access your web app at http://web.$DOMAIN"\n'))),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"List the created ingress"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},"kubectl get ingress web\n"))),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Access your web application"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},"curl http://web.$DOMAIN\n")),Object(l.b)("p",{parentName:"li"},"The output prints the html"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-html"},"<p><em>Thank you for using nginx.</em></p>\n"))),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Delete all the resources created"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-bash"},"kubectl delete deployment,svc,ingress -l app=web\n")))))}p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-lectures-kube-overview-activities-labs-ingress-iks-index-mdx-9795afe4a3fb825a297c.js.map